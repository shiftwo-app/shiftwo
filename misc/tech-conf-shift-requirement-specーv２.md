# 技術カンファレンス運営スタッフシフト管理アプリ — 要件定義ドラフト

## 1. 概要

- **目的 / 背景**  
  技術カンファレンス運営スタッフ（以下「スタッフ」）とスタッフリーダー（以下「リーダー」）向けに、複数ホール・複数役割のシフトを一元管理し、イベント当日の運営を円滑化する。
- **ゴール / 成功指標**
  - リーダーがシフト策定に要する時間を _50% 削減_
  - シフト確定後の当日トラブル件数 _0 件_（役割充足不足・休憩抜け漏れなど）
  - スタッフ満足度アンケートで _80% 以上_ が「希望が反映された」と回答

---

## 2. スコープ

| 項目 | MVP (v1) | 将来拡張 (v2+) |
|

## 3. 機能要件 (Functional Requirements)

### FR-1. タイムライン表示. タイムライン表示

1. **ライブラリ採用**: ガントチャート風 UI ライブラリ (react‑big‑calendar もしくは fullcalendar の timeGrid ビュー) を使用し、独自実装は行わない。
2. **縦軸切替**: 初期表示は「役割別」。UI トグルで「スタッフ別」に即時切替できる切替式。
3. **ズーム / スクロール UX**: デスクトップはホイール + Ctrl でズームイン / アウト。モバイルはピンチイン・ピンチアウトに対応。
4. **時刻フォーマット**: 24 時間表記 (HH:mm)。
5. **現在時刻インジケータ**: 当日中は赤い縦線をリアルタイムで進行させる。
6. **ドラッグ & ドロップ編集**: シフトの移動 / 長さ調整は「編集モード」有効時かつリーダー権限のみ操作可能。
7. **アクセシビリティ**: キーボード操作 (← → ↑ ↓ / Enter) 対応、ARIA ラベル付与、WCAG 2.1 AA コントラストを確保。
8. **ズームレベル切替**: 5 / 10 / 15 / 30  分単位をプルダウンで変更可。
9. **パフォーマンス**: 仮想スクロールにより 100+ スタッフ / 役割でも 60 fps を維持。

### FR-2. 役割カラー設定

1. **カラー選択方式**: 固定パレット (10 色想定)。
2. **初期色**: 役割追加直後はグレー (#CCCCCC)。リーダーが後から編集。
3. **編集 UI**: 「役割一覧」設定ページで色を一括管理 (モーダル + カラーパレット)。
4. **カラーブラインド対応**: 色に加えてストライプ / ドットなど模様オプションを指定可能。
5. **ダークモード**: 対応は将来検討 (v2 予定)。
6. **配色重複**: 重複選択時は警告を表示するが保存は可能。
7. **エクスポート影響**: PDF / CSV / 印刷時に色を保持。モノクロ印刷時は役割名 + 記号 (◯ ▲ ■ 等) を併記。
8. **データ構造**: 役割カラーは設定テーブル側で管理 (role_settings JSON 内)。role テーブルに color 列は追加しない。

### FR-3. レスポンシブ対応

1. **ブレークポイント**: Tailwind の標準を採用 (`sm ≤ 640 px`, `md ≤ 1024 px`, `lg > 1024 px`)。
2. **モバイル機能範囲**: スマートフォン / タブレットでもデスクトップと **完全同等** の閲覧・編集機能を提供。
3. **タッチジェスチャ**: ピンチイン / ピンチアウトでズーム操作を実装。ドラッグ・ロングプレスなどの基本操作は FR‑1 に準拠。
4. **ナビゲーション UI**: モバイルはハンバーガードロワーを採用。デスクトップではサイドバーを縮小アイコン化し、ホバーで展開。
5. **PWA 対応**: v1 から Web App Manifest + Service Worker を用意し、ホーム画面追加を可能にする（オフライン完全対応は行わない）。
6. **パフォーマンス基準 (モバイル)**: 4G 回線・低〜中端機で FCP ≤ 2 s、インタラクティブ ≤ 3 s を目標とする。
7. **オリエンテーション**: スマホは縦向きレイアウトを推奨。横向きでも表示崩れは起こさない。
8. **アクセシビリティ (モバイル)**: フォーカスリング／ARIA ランドマークを実装し、ピンチ非対応ユーザ向けにズームボタンも提供。
9. **テスト対象デバイス**: iPhone SE (2nd), iPhone 15, Pixel 8, iPad (10th), Galaxy Fold (folded) で UI 検証を行う。

### FR-4. シフト作成 / 編集

1. **時間粒度設定 (FR‑4‑A)**: 時間粒度 (5 / 10 / 15 / 30  分) は _設定画面で事前に固定_。イベント途中での変更は不可。
2. **シフト作成 UI (FR‑4‑B)**: 開始時刻・終了時刻をフォーム入力してシフト枠を生成する方式を採用。タイムライン上でのドラッグ描画は v2 以降。
3. **複数役割兼務表示 (FR‑4‑C)**: スタッフ 1 名が兼務する場合は _行を分けてネスト表示_ し、行ヘッダにスタッフ名をまとめて表示。
4. **必要人員ガイド (FR‑4‑D)**: 各時間帯 × 役割セルに充足状況を _数字バッジ_ (例: `2/3`) で表示。定員未達時は赤背景。
5. **希望オーバーライド視覚化 (FR‑4‑E)**: スタッフ希望と異なる割当シフト枠は _枠線色をオレンジ_ に変更し、ツールチップで理由を表示。
6. **操作モード (FR‑4‑F)**: ① 閲覧モード / ② 編集モード を右上トグルで切替。デフォルトは閲覧モード。
7. **Undo / Redo (FR‑4‑G)**: 直前 1  手のみ取り消しできる「手戻し」機能を実装。Redo は v2 で検討。
8. **既存機能との整合**: FR‑4‑2 (複数役割兼務)・FR‑4‑3 (必要人員管理)・FR‑4‑4 (オーバーライド可視化) は上記仕様でカバー。

### FR-5. スタッフ希望・制約入力

1. **入力締切 (FR‑5‑A)**: スタッフは開催 **○ 日前まで** に希望を提出。締切日時はリーダーが設定し、締切以降はフォームをロック。
2. **入力方式 (FR‑5‑B)**: デスクトップ / モバイル両対応の **Web フォーム** を提供。
3. **休憩時間入力 UI (FR‑5‑C)**: 休憩開始・終了時刻を **プルダウン選択** で入力。
4. **役割希望入力 UI (FR‑5‑D)**: 役割を **チェックボックス複数選択** で入力（優先順位付けなし）。
5. **メモ入力制限 (FR‑5‑E)**: 任意入力、**200 文字** まで。改行可。
6. **フィードバック通知 (FR‑5‑F)**: シフト確定後、**メール or Slack DM** でスタッフへ希望反映状況を通知。
7. **締切後の変更フロー (FR‑5‑G)**: 締切後はフォームを完全ロック。変更が必要な場合はリーダーが手動で調整。
8. **バリデーション (FR‑5‑H)**: 重複休憩・イベント時間外・重複役割選択を即時エラー表示。
9. **データモデル (FR‑5‑I)**: `shift_preferences` テーブルに `user_id`, `date`, `break_start`, `break_end`, `roles[]`, `memo` を保持。
10. **インポート / エクスポート (FR‑5‑J)**: v1 で **CSV 一括登録** をサポート。Google Sheets 連携は v2 で検討。

### FR-6. イベントタイムテーブル連携

1. **タイムテーブル登録方法 (FR‑6‑A)**: v1 で **CSV / JSON インポート** をサポート。インポート後に一覧画面で確認・編集。手入力 UI は v2 以降に検討。
2. **複数ホール表示 (FR‑6‑B)**: タイムラインを左右に **列追加** して各ホールを並列表示 (A | B | C …)。ホールごとに色付きラベルを表示。
3. **表示レイヤ (FR‑6‑C)**: セッション枠をタイムライン上に **透過オーバーレイ** で重ねて表示。トグルスイッチで表示 / 非表示を切り替え。
4. **編集権限 (FR‑6‑D)**: **リーダーのみ** タイムテーブルのインポート・削除・再インポートが可能。
5. **セッション属性 (FR‑6‑E)**: 必須: _タイトル・登壇者・開始/終了時刻・部屋名_。任意: _トラック色・タグ_ を保持。
6. **利用シーン (FR‑6‑F)**: ① スタッフ希望入力時の参考表示。② 当日進行監視として現在時刻ラインと比較し、進行遅延が一目で分かる。
7. **インポート / エクスポート (FR‑6‑H)**: v1 ではインポートのみ。エクスポート (CSV) は v2 で検討。
8. **データモデル (FR‑6‑I)**: `event_sessions` テーブル (`id`, `title`, `speaker`, `room`, `start`, `end`, `track_color`, `tags[]`, `import_source`).

### FR-7. シフト確認 & レポート

1. **ビュー切替 (FR‑7‑A)**: 画面上トグルで **役割別** / **スタッフ別** を瞬時に切替。検索ボックス付きドロップダウンで特定スタッフをフィルタ可能。
2. **休憩時間計算ルール (FR‑7‑B)**: (a) 休憩役割カード + (b) **シフト間空白 N  分以上** (設定値、デフォルト 15 分) を休憩として合算。
3. **充足率サマリ (FR‑7‑C)**: 役割別の充足率を **数値 (%) とプログレスバー** で表示。閾値 < 90 % でオレンジ、< 70 % で赤表示。
4. **スタッフ個別レポート (FR‑7‑D)**: スタッフを選択すると当日のシフト一覧と **休憩合計時間**、オーバーライド有無をカード表示。
5. **エクスポート形式 (FR‑7‑E)**: v1 で **CSV (UTF‑8)** エクスポートをサポート。<br>&emsp;• **役割別**: 列＝時間スロット、行＝役割。<br>&emsp;• **個人別**: 行＝スタッフ、列＝シフト枠一覧。
6. **リアルタイム更新 (FR‑7‑F)**: 編集完了後は利用者に **再読み込みボタン** を提示して最新状態を取得。WebSocket 自動更新は v2 で検討。
7. **アクセス権**: エクスポートはリーダーのみ。スタッフは自分の個別 CSV をダウンロード可能。
8. **PDF / 印刷 (v2)**: 印刷スタイルシート & PDF 出力を将来追加。

### FR-8. RBAC (利用者・権限管理)

1. **デフォルトロール定義**
   - **イベントシフト管理者 (Admin)**: システム全体設定、ユーザ・ロール管理、閲覧権限全て。
   - **シフト作成の管理者**: シフト CRUD、役割設定、必要人数入力、スタッフ希望承認。
   - **スタッフ (Staff)**: 自身の希望入力、シフト閲覧のみ。
2. **権限制御**
   - **API レイヤ**: JWT クレームにロールを埋め込み、バックエンドでエンドポイントごとに許可 / 拒否。
   - **フロントエンド**: ガード付きルーティング & コンポーネントレベルの表示制御。
3. **カスタムロール作成**
   - **カスタムロール**: カスタムの権限を設定する

## 4. 非機能要件 (NFR)

| NFR ID | 要件                 | 指標 / 基準                                        |
| ------ | -------------------- | -------------------------------------------------- |
| NFR‑1  | **表示速度**         | 主要画面 FCP ≤ 2 s (4G モバイル, 85th percentile)  |
| NFR‑2  | **同時編集耐性**     | v1: 単一リーダー編集のみ, v2: リアルタイム協調編集 |
| NFR‑3  | **ブラウザ対応**     | Chrome, Edge, Safari, Firefox 各最新 2 バージョン  |
| NFR‑4  | **アクセシビリティ** | WCAG 2.1 AA 準拠の配色コントラスト                 |
| NFR‑5  | **国際化**           | 日本語 UI (v1), 英語 (v2)                          |

---

## 5. 技術 & 制約

- **フロントエンド**: Next.js 14 (App Router) + TypeScript
- **UI コンポーネント**: MUI または shadcn/ui
- \*\*カレンダー / ガントライブラリ候補

  - ✅ **決定**: v1 は MIT ライブラリを採用 (独自実装は当面行わない)
  - react-big-calendar (MIT)
  - fullcalendar (MIT)

- **デプロイ / インフラ**: Docker → AWS Fargate または Vercel (要検討)
- **DB**: Supabase / Postgres 予定 (Docker compose)

---

## 6. 依存関係 & ステークホルダー

| 役割               | 氏名 / チーム | 関与                   |
| ------------------ | ------------- | ---------------------- |
| プロダクトオーナー | あなた        | 方向性決定 / 優先順位  |
| 開発リーダー       | (未定)        | 仕様策定 / 技術選定    |
| デザイナー         | (未定)        | UI/UX / カラーパレット |
| インフラ担当       | (未定)        | AWS / Docker           |

---

## 8. 既知のリスク / 懸念

1. ガント系 UI が複雑化 → 実装コスト増大
2. 同時編集機能は v1 でスコープ外にしないとスケジュール遅延の恐れ
3. スタッフ BYOD のためスマホ画面サイズ多様 (横スクロール UX)

---

## 9. スケジュール (案)

| マイルストーン  | 期限           | 備考                             |
| --------------- | -------------- | -------------------------------- |
| 要件確定        | **2025-04-30** | 本ドキュメント Fix               |
| プロトタイプ UI | 05-14          | ガント UI + スタッフ希望入力画面 |
| MVP 実装完了    | 06-15          | α テスト                         |
| 公開リリース    | 06-30          | カンファレンス 1 か月前          |

---

## 10. オープンクエスチョン

1. **認証方式**: Google / GitHub / email & password のどれを採用？
2. **権限レベル**: リーダー以外に「副リーダー」「閲覧専用」など追加要否？
3. **通知機能**: v1 からメール送信 or Slack DM を入れるか？
4. **タイムテーブルインポート**: CSV / JSON インポートは必要？
5. **タイムゾーン**: 国際カンファレンスの場合に UTC or 現地時刻対応は？
6. **当日実績**: 出退勤打刻や実績ログを取りたいか？
7. **外部カレンダー連携**: Google Calendar などへのエクスポート要否？
8. **データ保持期間**: シフト情報を何年間保存する？
9. **アクセシビリティ要件**: 視覚障害者向け音声読み上げ対応は v1 スコープ？
10. **ライセンス**: MIT 以外 (Apache‑2.0 など) も可か？

---

### 次のアクション

1. **オープンクエスチョン** に回答 or コメントをいただく
2. 追加・修正点を反映し、要件を確定
3. MVP 優先度 & スケジュールを最終合意

---

> **ご確認ください！**  
> ドキュメント内容をレビューし、追記・修正・質問などコメントで教えてください。
